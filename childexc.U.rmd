---
title: "children Excercise"
author: "Harish"
date: "02/04/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, echo = FALSE}
suppressMessages(library(readxl))
suppressMessages(fit_database_exercise_normal <- read_excel("~/SharedFiles/ST606/2020/data/Exercise/fit_database_exercise_normal.xlsx"))
suppressMessages(fit_database_anthropometric_all<-read_excel("~/SharedFiles/ST606/2020/data/Exercise/fit_database_anthropometric_all.xlsx"))

```

```{r, include = FALSE}
str(fit_database_exercise_normal)
suppressWarnings(fit_database_exercise_normal$gender <- as.factor(fit_database_exercise_normal$gender))
suppressWarnings(fit_database_exercise_normal$`running distance (m)` <- as.integer(fit_database_exercise_normal$`running distance (m)`))
suppressWarnings(fit_database_exercise_normal$`running time (s)` <- as.numeric(fit_database_exercise_normal$`running time (s)`))
suppressWarnings(fit_database_exercise_normal$`running speed (m/s)` <- as.numeric(fit_database_exercise_normal$`running speed (m/s)`))
suppressWarnings(fit_database_exercise_normal$`z-category (WHO)` <- as.factor(fit_database_exercise_normal$`z-category (WHO)`))
suppressWarnings(fit_database_exercise_normal$`pulse 0'` <- as.numeric(fit_database_exercise_normal$`pulse 0'`))
suppressWarnings(fit_database_exercise_normal$`pulse 1'` <- as.numeric(fit_database_exercise_normal$`pulse 1'`))
suppressWarnings(fit_database_exercise_normal$`pulse 5'` <- as.numeric(fit_database_exercise_normal$`pulse 5'`))
suppressWarnings(fit_database_exercise_normal$`pulse 10'`<- as.numeric(fit_database_exercise_normal$`pulse 10'`))
suppressWarnings(fit_database_exercise_normal$`SBP 0'` <-   as.numeric(fit_database_exercise_normal$`SBP 0'`))
suppressWarnings(fit_database_exercise_normal$`SBP 1'` <-   as.numeric(fit_database_exercise_normal$`SBP 1'`))
suppressWarnings(fit_database_exercise_normal$`SBP 5'` <-   as.numeric(fit_database_exercise_normal$`SBP 5'`))
suppressWarnings(fit_database_exercise_normal$`SBP 10'`<-   as.numeric(fit_database_exercise_normal$`SBP 10'`))
suppressWarnings(fit_database_exercise_normal$`DBP 0'`<-    as.numeric(fit_database_exercise_normal$`DBP 0'`))
suppressWarnings(fit_database_exercise_normal$`DBP 1'`<-    as.numeric(fit_database_exercise_normal$`DBP 1'`))
suppressWarnings(fit_database_exercise_normal$`DBP 5'`<-    as.numeric(fit_database_exercise_normal$`DBP 5'`))
suppressWarnings(fit_database_exercise_normal$`DBP 10'`<-   as.numeric(fit_database_exercise_normal$`DBP 10'`))
suppressWarnings(fit_database_exercise_normal$uniqueid<-    row(fit_database_exercise_normal))

```



```{r echo = FALSE}

suppressMessages(library(dplyr))
suppressMessages(library(tidyverse))
suppressMessages(library(ggplot2))
suppressMessages(library(ggpubr))
suppressMessages(library(MASS))
suppressMessages(library(GGally))
suppressMessages(library(leaps))
suppressMessages(library(ISLR))
suppressMessages(library(caret))
suppressMessages(library(glmnet))
suppressMessages(library(psych))
suppressMessages(library(DT))
```
## Introduction
- This database is a large dataset representing the account for pulse rate, Systolic Blood pressure and Diastolic blood pressure of childrens  of different age groups during a field exercise test. 

- Anthropometric and hemodynamic parameters are measured both during relaxation and after exercise containing 1,173,342 data segments from 65,345 acquisition points of 10,894 normal weight childrens, covering an age range of 6â€“18 years collected in a course of 12 years. 

## Data Cleaning
1) During the experimental period observations were taken twice a year and hence no children was supposed to have more than two observations per    year but several observations were found where a children had more than two observations per year because of 

- Two observations on same day: Seven observations were removed. 

- Wrong age is updated : correct age is imputed 

- Age exceeding 18 years : Two observations were removed


```{r, include = FALSE}

### id 6,7,8 have no errors like this so they are not shown.
exc9  <- fit_database_exercise_normal %>% filter(fit_database_exercise_normal$`age bin` == 9)
length(unique(exc9$ID))
head(sort(table(exc9$ID), decreasing = TRUE))
wrong_9 <- exc9[exc9$ID %in% c(6152,6502),] 
  
exc10 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 10)
length(unique(exc10$ID))
head(sort(table(exc10$ID), decreasing = TRUE))
wrong_10 <- exc10[exc10$ID %in% c(2776,2802),] 

exc11 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 11)
length(unique(exc11$ID))
head(sort(table(exc11$ID), decreasing = TRUE))
wrong_11 <- exc11[exc11$ID %in% c(2770,5093),] 

exc12 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 12)
length(unique(exc12$ID))
head(sort(table(exc12$ID), decreasing = TRUE))
wrong_12 <- exc12[exc12$ID %in% c(1251,1309,1471),] 

exc13 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 13)
length(unique(exc13$ID))
head(sort(table(exc13$ID), decreasing = TRUE))
wrong_13 <- exc13 %>% filter(exc13$ID == 7244)

exc14 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 14)
length(unique(exc14$ID))
head(sort(table(exc14$ID), decreasing = TRUE))
wrong_14 <- exc14 %>% filter(exc14$ID == 5935)

exc15 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 15)
length(unique(exc15$ID))
head(sort(table(exc15$ID), decreasing = TRUE))
wrong_15 <- exc15 %>% filter(exc15$ID == 3041)

exc16 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 16)
length(unique(exc16$ID))
head(sort(table(exc16$ID), decreasing = TRUE))
wrong_16 <- exc16[exc16$ID %in% c(3041,3011),]


age_mismatch<- rbind(wrong_9,wrong_10,wrong_11,wrong_12,wrong_13,wrong_14,wrong_15,wrong_16)

### age_mismatch is dataset with 3 observations per individual per year which is not feasible and hence wrong ages are updated.
### age=9, ID = 6152(G), 6502(B)        : 2016-04-01    : two observations on same day.
### age10, ID = 2776(B), 2802(G)        : 2015-10-01    : wrong age recorded on 2015-04-01 can be imputed for both id.
### age11, ID = 2770(G), 5093(G)        : 2016-04-01    : 5093(G) two observations on the same day, 2770(G) wrong age recorded on 2015-04-01 can be imputed.
### age12, ID = 1251(B),1309(B),1471(G) : 2016-04-01    : two observations on the same day for all three observations.
### age13, ID = 7244(G)                 : 2013-10-01    : first observatio age 13, second observation age 13.5 and third observation age 13.    
### age14, ID = 5935(G)                 : 2016-04-01    : two observations recorded on the same day.
### age15, ID = 3041(G)                 : 2015-10-01    : Wrong age updated.
### age16, ID = 3011(B),3041(G)         : 2015-10-01	  : 3011(B),wrong age updated, 3041(G),Wrong age updated and even exceeding 19 years.

### Removing those Rows from the table with incorrect values.
fit_database_exercise_normal <- fit_database_exercise_normal[-c(40510,40511,40512,42352,42353,42354,22214,22215,22216,22373,22374,22375,22195,22196,22197,35480,35481,35482,11329,11330,11331,11840,11841,11842,13354,13355,13356,45379,45380,45381,39074,39075,39076,23055,23056,23057,22976,22977,22978,23058,23059,23060),]

### Imputing correct ages where wrong ages were mentioned.

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,9,11.308447)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,9,11)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,11,11.119406)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,11,11)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,14,12.145205)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,14,12)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,15,12.645205)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,15,12)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,29,14.018037)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,29,14)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,36,16.678082)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,36,16)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,41,17.178082)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,41,17)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,42,17.678082)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,42,17)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,38,17.015297)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,38,17)

### Removing those rows where multiple observations were taken on the same day.
age_mismatch <- age_mismatch[-c(2,6,18,21,23,26,33),]

fit_database_exercise_normal <-rbind(fit_database_exercise_normal,age_mismatch)


### Again rechecking for more than two ages in a single year.
exc11 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 11)
length(unique(exc11$ID))
head(sort(table(exc11$ID), decreasing = TRUE))
wrong_11 <- exc11[exc11$ID %in% c(2802),] 

exc12 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 12)
length(unique(exc12$ID))
head(sort(table(exc12$ID), decreasing = TRUE))
wrong_12 <- exc12[exc12$ID %in% c(2770),] 


exc14 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 14)
length(unique(exc14$ID))
head(sort(table(exc14$ID), decreasing = TRUE))
wrong_14 <- exc14 %>% filter(exc14$ID == 7244)

age_mismatch<- rbind(wrong_11,wrong_12,wrong_14)

### Removing rows with age mismatch.
fit_database_exercise_normal <- fit_database_exercise_normal[-c(65312,22358,22359,22186,22187,65315,65316,65326,45340,45341),]

### Imputing correct age.
age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,1,11.61941)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,1,11)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,2,12.11941)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,2,12)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,4,13.14521)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,4,13)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,5,13.64521)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,5,13)


age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,10,13.01804)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,10,13)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,9,13.51804)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,9,13)

fit_database_exercise_normal <-rbind(fit_database_exercise_normal,age_mismatch)

### Again rechecking for more than two ages in a single year.

exc12 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 12)
length(unique(exc12$ID))
head(sort(table(exc12$ID), decreasing = TRUE))
wrong_12 <- exc12[exc12$ID %in% c(2802),] 

exc13 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 13)
length(unique(exc13$ID))
head(sort(table(exc13$ID), decreasing = TRUE))
wrong_13 <- exc13[exc13$ID %in% c(7244,2770), ]

age_mismatch<- rbind(wrong_12,wrong_13)

### Removing rows with age mismatch.
fit_database_exercise_normal <- fit_database_exercise_normal[-c(22356,22357,65330,65332,65333,22186,65338,65337,65316,65317),]


### Imputing correct age.

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,1,12.61941)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,1,12)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,2,13.11941)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,2,13)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,4,14.14521)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,4,14)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,5,12.01804)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,5,12)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,6,12.51804)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,6,12)

fit_database_exercise_normal <-rbind(fit_database_exercise_normal,age_mismatch)

### Again rechecking for more than two ages in a single year.

exc12 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 12)
length(unique(exc12$ID))
head(sort(table(exc12$ID), decreasing = TRUE))
wrong_12 <- exc12[exc12$ID %in% c(7244),] 

age_mismatch<-wrong_12

### Removing rows with age mismatch.
fit_database_exercise_normal <- fit_database_exercise_normal[-c(65334,65333,45332),]

### Imputing correct age. 
age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,1,11.51804)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,1,11)

fit_database_exercise_normal <-rbind(fit_database_exercise_normal,age_mismatch)

### Again rechecking for more than two ages in a single year.
exc17 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 17)
length(unique(exc17$ID))
head(sort(table(exc17$ID), decreasing = TRUE))

wrong_17 <- exc17[exc17$ID %in% c(3011,3041),] 

age_mismatch<-wrong_17

### Removing rows with age mismatch.
fit_database_exercise_normal <- fit_database_exercise_normal[-c(22951,22952,23027,65318,65321,65322),]

### Imputing correct age. 
age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,1,18.01530)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,1,18)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,2,18.51530)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,2,18)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,3,18.67808)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,3,18)

fit_database_exercise_normal <-rbind(fit_database_exercise_normal,age_mismatch)

### Again rechecking for more than two ages in a single year.
exc18 <-fit_database_exercise_normal  %>% filter(fit_database_exercise_normal$`age bin` == 18)
length(unique(exc18$ID))
head(sort(table(exc18$ID), decreasing = TRUE))
wrong_18 <- exc18[exc18$ID %in% c(3011),] 

age_mismatch<- wrong_18

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,2,19.51530)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,2,19)

age_mismatch$`age (years)` <-replace(age_mismatch$`age (years)`,1,19.01530)
age_mismatch$`age bin` <-replace(age_mismatch$`age bin`,1,19)

fit_database_exercise_normal <- fit_database_exercise_normal[-c(65333,65334,22951,22952),]

age_mismatch<- age_mismatch[-c(1,2),] ### Rows removed because there age was more than 18. 

fit_database_exercise_normal <-rbind(fit_database_exercise_normal,age_mismatch)

```


```{r, include = FALSE}

# no of observations with age less than 10.
lessthan10<- fit_database_exercise_normal %>% filter(fit_database_exercise_normal$`age bin` < 10)

# no of observations with age less than 10 but ran 2000.(2)
exc1 <- lessthan10 %>% filter(lessthan10$`running distance (m)` ==2000)

# no of observations with age greater than 10.
morethan10<-fit_database_exercise_normal %>% filter(fit_database_exercise_normal$`age bin` > 10)

exc2 <- morethan10 %>% filter(morethan10$`running distance (m)` ==1000)

incorrectboys <- exc2 %>% filter(exc2$gender=="boy")
incorrectgirls <- exc2 %>% filter(exc2$gender=="girl")

incorrectboys$ID <- as.factor(incorrectboys$ID)
length(unique(incorrectboys$ID))
head(sort(table(incorrectboys$ID), decreasing = TRUE))
# 695 distinct boys ran incorrect distance from the total of 922 observations and most of the individuals ran incorrect distance 1 or 2 times but some individuals with ID  5158, 618, 2225, 5142, 1923 and 2994 ran incorrect distance multiple times.

incorrectgirls$ID <- as.factor(incorrectgirls$ID)
length(unique(incorrectgirls$ID))
head(sort(table(incorrectgirls$ID), decreasing = TRUE))
# 845 distinct girls ran incorrect distance from the total of 1329 observations and most of the girls ran incorrect distance 1 or 2 times but some individuals with ID 5160, 1442, 4733, 149, 189 and 5156  ran incorrect distance multiple times.


# To remove those observations were childrens ran incorrect distance. 
ID1 <- exc1$uniqueid
ID2 <- exc2$uniqueid
# normal dataset after removing wrong data for running distance.
cleandata <- fit_database_exercise_normal[-ID1,]
cleandata <- cleandata[-ID2,]

```



2) During the experiment childrens with age less than 10 were asked to ran 1000 metres while childrens with age greater than 10 were asked to ran   2000 metres but 

- 2 girls ran 2000 metres however, they were supposed to ran only 1000.

- 2248 observations found where running distance was only 1000 metres, but they were supposed to ran 2000.

- 921 Number of observations are found were boys ran incorrect distance. 

- 1327 Number of observations are found were girls ran incorrect distance. 

- So from the total observation of 2250 where individuals ran incorrect distance 59% were girls observation.


```{r echo = FALSE}
 
 ggplot(exc2)+
geom_bar(mapping = aes(x= `age bin`, fill = gender))
  
ggplot(exc2)+
  geom_bar(mapping = aes(x= `age bin`))+
  facet_wrap(~gender)

```


- From the two plots we can say that boys and girls with age equal to 11 years were certainly more in numbers as compared to other age childrens   who ran incorrect distance.




## Analysis of the observations were running distance is given but running time and running speed is missing.

Two cases:

1) Those childrens who were asked to not participate in the run because of dangerous pulse, SBP, DBP at rest or due to any other physical injury.

2) Those childrens who left the running track in between so there observations for running time and running speed is missing or it is also a        possibility that some students were to slow so that there details of speed and time were not recorded.

Case 1 : This is the case where childrens where assigned a distance to run according to there ages but at the time of the race these childrens            were either asked to not participate in the run because of dangerous pulse, SBP, DBP at rest or they didn't participated because of any          physical injury.

- I created a dataset where running distance is given but running time and running speed is absent.

- Then from that dataset I extracted those observations where readings taken at rest such as pulse 0, SBP 0, DBP 0 were present while all the      other observations which were supposed to be taken after the race were NA and hence we can consider these observations as the observations of    children who appeared for the run but where not allowed or they didn't participated in the ran.

- Total of 1666 childrens having 2337 observations were not cleared to run.

-  From the total of 2337 observations 987 observations were of boys while 1350 observations were of girls. so approximately 58% of the             observations were childrens were asked not to participate or didn't participated in the run because of any reason  were girls.

- From a total of 1666 childrens 739 were boys and 927 were girls.so approximately 56% of the childrens who were asked not to participate in the   run were girls.

```{r, include = FALSE}
# normal data set without Na values from running distance.
na_cases <- which(!complete.cases(cleandata$`running distance (m)`))
# na_cases is the dataset where running distance is NA.
naless <- cleandata[-na_cases,]
# naless is the dataset created after removing NA values related to running distance.
nadistance <- cleandata[na_cases,]
### nadistance is a dataset where running speed, running time, and running distance all are NA.
  
na_cases1<- which(!complete.cases(naless$`running time (s)`))
# na_cases1 is the set where running time and running speed is NA.
incomplete <- naless[na_cases1,]
# incomplete is the dataset where running time and running speed is NA in dataset naless where running distance is not NA or missing.


comp <- which(complete.cases(incomplete[,c(14,18,22)]))
comp1<-incomplete[comp,] 

na_data1<- which(!complete.cases(comp1$`pulse 1'`))
not_allowed <-comp1[na_data1,]

na_data2<- which(!complete.cases(not_allowed$`pulse 5'`))
not_allowed <-not_allowed[na_data2,]

na_data3<- which(!complete.cases(not_allowed$`pulse 10'`))
not_allowed <-not_allowed[na_data3,]

na_data4<- which(!complete.cases(not_allowed$`SBP 1'`))
not_allowed <-not_allowed[na_data4,]

na_data5<- which(!complete.cases(not_allowed$`SBP 5'`))
not_allowed <-not_allowed[na_data5,]

na_data6<- which(!complete.cases(not_allowed$`SBP 10'`))
not_allowed <-not_allowed[na_data6,]

na_data7<- which(!complete.cases(not_allowed$`DBP 1'`))
not_allowed <-not_allowed[na_data7,]

na_data8<- which(!complete.cases(not_allowed$`DBP 5'`))
not_allowed <-not_allowed[na_data8,]

na_data9<- which(!complete.cases(not_allowed$`DBP 10'`))
not_allowed <-not_allowed[na_data9,]

### not_allowed is the dataset where running distance and observations at rest are measured while running speed, running time and pulse, sbp,dbp observations after the ran are absent and hence we can consider these observations as the observations of children who appeared for the ran but where not allowed or they didn't participated in the ran.

not_allowed$ID <- as.factor(not_allowed$ID)
length(unique(not_allowed$ID))
head(sort(table(not_allowed$ID), decreasing = TRUE))

### Total of 1666 childrens having 2337 observations were not cleared to run.

not_allowedboys<- not_allowed %>% filter(not_allowed$gender == "boy")
not_allowedgirls <- not_allowed %>% filter(not_allowed$gender == "girl")

### From the total of 2337 observations 987 observations were of boys while 1350 observations were of girls. so approximately 58% of the observations were childrens were asked not to participate in the run were girls.


not_allowedboys$ID <- as.factor(not_allowedboys$ID)
length(unique(not_allowedboys$ID))
head(sort(table(not_allowedboys$ID), decreasing = TRUE))

not_allowedgirls$ID <- as.factor(not_allowedgirls$ID)
length(unique(not_allowedgirls$ID))
head(sort(table(not_allowedgirls$ID), decreasing = TRUE))

### From a total of 1666 childrens 739 were boys and 927 were girls.so approximately 56% of the childrens who were asked not to participate in the run were girls.
```


```{r echo = FALSE}
ggplot(not_allowed)+
geom_bar(mapping = aes(x= `age bin`, fill = gender))
  
ggplot(not_allowed)+
  geom_bar(mapping = aes(x= `age bin`))+
  facet_wrap(~gender)
### Age group with the most childrens who were not cleared to run was 7. 


```

- Age group with the most childrens who were not cleared to run was 7. 

Case:2 : This is the case where childrens may have left the running track in between so there observations for running distance is given while            running time and running speed is missing. Here, we will remove those cases where all observations after the race where missing because          if an individual ran then there is a possibliity his/her measurements were taken even when the didn't completed the run or they were to          slow in the ran so that there details of speed, time were not recorded but other were taken because they did ran in the race.

- In this case, I removed all of those cases where only at rest observations were present and included every observation where atleast one after race reading is give.

- From the total of 3773 observations, 1750  are of boys and 2023 observations are for girls, So 53.6% of individuals who may have left running    in between are girls. 

- Running speed and time details of 1372 girls are missing in a total of 2023 observations. The data of most of the girls was missing for only 1   or 2 times but several girls have data missing multiple times. These are some ID's (240,5178,5977,6716,2777,4166) with missing data around 9-6   times.

- Running speed and time details of 1226 boys are missing in a total of 1750 observations. The data of most of the boys was missing for only 1 or   2 times but several boys have data missing multiple times. These are some ID's (1826,5158,482,3500,4798,5189) with missing data around 9-6       times.

- From 1750 observations of boys those may have left running track in between 911 were supposed to ran 1000 metres while 839 were supposed to ran   2000 metres.

- From 2023 observations of girls those may have left running track in between 1151 were supposed to ran 1000 metres while 872 were supposed to ran 2000 metres.

```{r, include = FALSE}

left <- incomplete[(!incomplete$ID %in% not_allowed$ID),]

leftboys <- left %>% filter(left$gender =="boy")
leftgirls <- left %>% filter(left$gender=="girl")

# From left dataset, 1750 observations are of boys and 2023 observations are for girls, So 53.6% of individuals who may have left running in between are girls. 

leftgirls$ID <- as.factor(leftgirls$ID)
length(unique(leftgirls$ID))
head(sort(table(leftgirls$ID), decreasing = TRUE))
# Running speed and time details of 1372 girls are missing in a total of 2023 observations. The data of most of the girls was missing for only 1 or 2 times but several girls have data missing multiple times. These are some ID's (240,5178,5977,6716,2777,4166) with missing data around 9-6 times.

leftboys$ID <- as.factor(leftboys$ID )
length(unique(leftboys$ID))
head(sort(table(leftboys$ID), decreasing = TRUE))
# Running speed and time details of 1226 boys are missing in a total of 1750 observations. The data of most of the boys was missing for only 1 or 2 times but several boys have data missing multiple times. These are some ID's (1826,5158,482,3500,4798,5189) with missing data around 9-6 times.

sum(leftboys$`running distance (m)`==1000)
### From 1750 observations of boys those may have left running track in between 911 were supposed to ran 1000 metres while 839 were supposed to ran 2000 metres.

sum(leftgirls$`running distance (m)`==1000)
### From 2023 observations of girls those may have left running track in between 1151 were supposed to ran 1000 metres while 872 were supposed to ran 2000 metres.

```

```{r echo = FALSE}

ggplot(left)+
  geom_bar(mapping = aes(x= `age bin`))+
  facet_wrap(~gender)

ggplot(left)+
  geom_bar(mapping = aes(x= `age bin`, fill = gender))

### Again Age group seven is the age when most students may have left running track in between or they were to slow in the ran so that there details were not recorded of speed, time and after race measurement.

```

- Again Age group seven is the age where most girls may have left running track in between or they were to slow in the ran so that there details   of speed, time were not recorded.

- Age group Fifteen is the age where most number of boys left running track in between. 

- A large number of girls from age 15 to 18 had there data missing while the number of boys with missing data decreases from age 15 - 18, which    shows more teenage boys like physical activity like running as compared to teenage girls.


  
## Plots to observe the proportions of each category for pulse, SBP, DBP.                                                                                        
 
* reference :- https://www.healthline.com/health/high-blood-pressure-hypertension/blood-pressure-reading-explained

* normal:- SBP(90-120) and DBP(60-80).
* Elevated:- SBP(120-130) and DBP(60-80).
* High blood pressure(stage 1) :- SBP(130-140) and DBP(80-89).
* High blood pressure(stage 2) :- SBP(140-179) and DBP(90-119).
* hypertensive crisis : SBP(>180) and DBP(>120).
* pulse rate : Active(40-60), normal(60-100), high(100-130), hypertensive crisis(130-180)



```{r echo = FALSE}
cleandata$catsbp<- cut(cleandata$`SBP 0'`, breaks = c(60,90,120,130,140,180, 220), labels = c("low", "normal", "Elevated", "High S1", "High S2", "hypertensive crisis"), right = FALSE,na.rm = TRUE)

cleandata$catdbp <- cut(cleandata$`DBP 0'`, breaks = c(30,60,80,90,120,160),labels = c("low", "normal", "High S1", "High S2", "hypertensive crisis"), right = FALSE,na.rm = TRUE)

cleandata$catpulse <- cut(cleandata$`pulse 0'`, breaks = c(40,60,100,130,200),labels = c("active", "normal", "High", "hypertensive crisis"), right = FALSE,na.rm = TRUE)
```



```{r echo = FALSE}
SS<-ggplot(data = cleandata) +
geom_bar(mapping = aes(fill = catsbp, x=""))

SBS <-ggplot(cleandata ,mapping = aes(x = catsbp, y = `SBP 0'` , fill = catsbp )) +
geom_boxplot(na.rm = TRUE)

DS <- ggplot(data = cleandata) +
geom_bar(mapping = aes(fill = catdbp, x=""))


DBS<- ggplot(cleandata ,mapping = aes(x = catdbp, y = `DBP 0'` , fill = catdbp )) +
geom_boxplot(na.rm = TRUE)

PS<- ggplot(data = cleandata) +
geom_bar(mapping = aes(fill = catpulse, x=""))

PBS<-ggplot(cleandata ,mapping = aes(x = catpulse, y = `pulse 0'` , fill = catpulse )) +
geom_boxplot(na.rm = TRUE)

 

fig <- ggarrange(SS, SBS,
                    labels = c("A", "B"),
                    ncol = 2, nrow = 1)


fig1 <- ggarrange( DS, DBS,
                    labels = c("A", "B"),
                    ncol = 2, nrow = 1)


fig2<- ggarrange( PS,PBS,
                    labels = c("A", "B"),
                    ncol = 2, nrow = 1)
fig


fig1


fig2

```

## Analysis of individuals with most observations and there atrest measurments throughout the experimental years.


- ID :147,227 participated in the experiment 22 times during the experimental years.

- These time series plots represents the pulse rate, systolic blood pressure and diastolic blood pressure of ID 147 and 227 at rest throuhout the   experimental years.

```{r, include = FALSE}

pulsetarget <- 100
SBPtarget <- 120
DBPtarget <- 80

cleandata$ID <- as.factor(cleandata$ID)

t_plot <- function(x){
  
 x <- filter(cleandata, ID==x)
  
 P<- ggplot(data= x,
aes(x=`measurement date`, y=`pulse 0'`)) + geom_line()+
geom_hline(yintercept=pulsetarget, color="red")

Q<-ggplot(data= x,
aes(x=`measurement date`, y=`SBP 0'`)) + geom_line()+
  geom_hline(yintercept=SBPtarget, color="red")

R<-ggplot(data= x,
aes(x=`measurement date`, y=`DBP 0'`)) + geom_line()+
  geom_hline(yintercept=DBPtarget, color="red")

figure7 <- ggarrange(
  P,                
  ggarrange(Q, R, ncol = 2, labels = c("B", "C")), 
  nrow = 2, 
  labels = "A"  
  ) 
  
figure7 
}

length(levels(cleandata$ID))
head(sort(table(cleandata$ID), decreasing = TRUE))



```

```{r echo=FALSE}

 t_plot(147)
 t_plot(227)
```

##  Analysis of the average pattern of pulse, SBP and DBP observations with respect to experimental years.

```{r echo = FALSE}

pulse0 <- cleandata%>%
group_by(`measurement date`) %>%
summarise(pulse0Mean = mean(`pulse 0'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=pulse0Mean)) + geom_line()

pulse1 <- cleandata%>%
group_by(`measurement date`) %>%
summarise(pulse1Mean = mean(`pulse 1'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=pulse1Mean)) + geom_line()

pulse5 <- cleandata%>%
group_by(`measurement date`) %>%
summarise(pulse5Mean = mean(`pulse 5'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=pulse5Mean)) + geom_line()

pulse10 <- cleandata%>%
group_by(`measurement date`) %>%
summarise(pulse10Mean = mean(`pulse 10'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=pulse10Mean)) + geom_line()

figure2 <- ggarrange(pulse0, pulse1, pulse5,pulse10,
                    labels = c("A", "B", "C", "D"),
                    ncol = 2, nrow = 2)
figure2

```


- From the 1 plot we can say the average resting pulse throughout the experimental years was under 100 and hence normal.

- From the 2 plot we can say the average pulse just after the run from 2007-2013 was consistently over 135 which is very high but after 2013 the   average pulse rate decreases and even getting less than 120 is 2016 which can be considered good as pulse 1 as it was taken just after  a        minute completing the run.

- From the 3 plot we can say the average pulse after 5 minutes of the run was consistently less than 116 and reaches its lowest average in 2018    and a decresing trend is visible in avg pulse rate after 5 min of race over the period of experimental years.

- From the 4 plot we can say the average pulse after 10  minutes of the run was nearly same to the pulse rate after 5  minutes as they both        satayed around than 110-115. The lowest average for pulse10 was recorded in 2008.

```{r echo = FALSE}

SBP0 <- cleandata%>%
group_by(`measurement date`) %>%
summarise(SBP0Mean = mean(`SBP 0'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=SBP0Mean)) + geom_line()

SBP1 <-cleandata%>%
group_by(`measurement date`) %>%
summarise(SBP1Mean = mean(`SBP 1'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=SBP1Mean)) + geom_line()

SBP5 <-cleandata%>%
group_by(`measurement date`) %>%
summarise(SBP5Mean = mean(`SBP 5'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=SBP5Mean)) + geom_line()

SBP10 <-cleandata%>%
group_by(`measurement date`) %>%
summarise(SBP10Mean = mean(`SBP 10'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=SBP10Mean)) + geom_line()

figure1 <- ggarrange(SBP0, SBP1, SBP5,SBP10,
                    labels = c("A", "B", "C", "D"),
                    ncol = 2, nrow = 2)
figure1

```

- Average SBP at rest after 2009 remained under 120 and hence normal but in 2008 it was around 126 which is considered high at rest.

- Average SBP after 1 min of the run was between 155-125 which is above normal but this value decreases every year from it's peak in 2008 to it's   lowest in 2016.

- Average SBP after 5 min of the run was between 125-112. This value decreases every year from it's peak in 2008 to it's lowest in 2015. After     2009 it's value was consistently less than 120 which is normal. So, we can say after 5 min of the run average SBP tends to get normal. 

- With the exception of year 2007 SBP after 10 mins of run was normal throughout the experimental years.

 
```{r echo = FALSE}

DBP0<- cleandata %>%
group_by(`measurement date`) %>%
summarise(DBP0Mean = mean(`DBP 0'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=DBP0Mean)) + geom_line()

DBP1<- cleandata%>%
group_by(`measurement date`) %>%
summarise(DBP1Mean = mean(`DBP 1'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=DBP1Mean)) + geom_line()

DBP5<- cleandata%>%
group_by(`measurement date`) %>%
summarise(DBP5Mean = mean(`DBP 5'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=DBP5Mean)) + geom_line()

DBP10<- cleandata%>%
group_by(`measurement date`) %>%
summarise(DBP10Mean = mean(`DBP 10'`,na.rm = TRUE)) %>%
ggplot(aes(x= `measurement date`, y=DBP10Mean)) + geom_line()

figure <- ggarrange(DBP0, DBP1, DBP5,DBP10,
                    labels = c("A", "B", "C", "D"),
                    ncol = 2, nrow = 2)
figure

```

- Average distolic blood pressure throughout the experimental years at rest, after 1 min , after 5min and after 10 min of the run remained under   the normal category and reaching it's lowest value in 2018 and that to was normal so we can say running exercise doesn't seem to have much       impact on the distolic blood pressure.

## Plots to show the Relation betweeen the obseravtions at rest , at 1 min , at 5 min  and at 10 min.

```{r, include = FALSE}
complete <-naless[-na_cases1,]
# complete is the data set created after removing NA values related to running distance, running speed and running time from the dataset cleandata which was created after removing 2253 cases where the childrens ran incorrect distance. 

remove_all <- which(!complete.cases(complete[14:25]))
cleanPSD <- complete[-remove_all,]
# clean PSD is the dataset which is obtained by removing all the missing value related to pulse rate, SBP and DBP. Imputation is not performed here because missing values where more than 5%.
```


```{r echo = FALSE}

suppressWarnings(ggpairs(cleanPSD, columns= 14:17,aes(fill=gender,alpha = 0.7),progress = FALSE))

suppressWarnings(ggpairs(cleanPSD, columns= 18:21,aes(fill=gender,alpha = 0.7), progress = FALSE))

suppressWarnings(ggpairs(cleanPSD, columns= 22:25,aes(fill=gender,alpha = 0.7),  progress = FALSE))

```

- From the plot for pulse, SBP and DBP highest correlation is between variables at 5 min and variables at 10, so plotting pulse, SBP and DBP at 5   VS pulse, SBP and DBP at 10. 


## Density plots for relation between measuremnets take after 5 min and 10 min of the ran
```{r echo = FALSE}
p <- ggplot(cleanPSD,aes(`pulse 5'`,`pulse 10'`))
q <- ggplot(cleanPSD,aes(`SBP 5'`,`SBP 10'`))
r <- ggplot(cleanPSD,aes(`DBP 5'`,`DBP 10'`))

 P5_10 <-p + stat_bin2d()+
scale_fill_gradient(low = "lightblue1", high = "steelblue4")

S5_10 <-q + stat_binhex()+
scale_fill_gradient(low = "lightblue1", high = "steelblue4")

D5_10 <- r + stat_density2d(aes(fill = ..level..), geom = "polygon")

figure3 <- ggarrange(
  P5_10,                
  ggarrange(S5_10, D5_10, ncol = 2, labels = c("B", "C")), 
  nrow = 2, 
  labels = "A"  
  ) 
  
figure3

```

## Modelling

- Analysis for a specific age group. Selecting age bin = 10, becuase childrens in age 10 ran 1000 and 2000 metres. 

- Randomly selecting 1 observation per child in age group 10.

- Using pulse10 as response variable in subset regression.

- Bmi, Zscore, Zcategory variables are removed as they all are dependent on weight and height. variable speed is also removed as it depends upon   distance and time, Age is removed as age bin 10 is selected.r

- Technique used is subset regression.


```{r, include =FALSE}
age10<- cleandata%>% filter(cleandata$`age bin`== 10)

age10$ID <- as.factor(age10$ID)
length(unique(age10$ID))
head(sort(table(age10$ID), decreasing = TRUE))


###Using pulse10 as response variable in subset regression.

singleid <- age10%>% distinct(ID, .keep_all = TRUE)
head(sort(table(singleid$ID), decreasing = TRUE))
### Singleid is a dataset with age greater than 10 and less than 11 and keeping only one one observation per child. For example id 2776 had 3 observation in this age group but only one is considered and remaining two were removed.


MyData <- singleid[,-c(1,3,4,8:10,13,26:29)]
### bmi, zscore, zcategory variables are removed as they all are dependent on weight and height. variable speed is also removed as it depends upon distance and time, Age is removed as age bin 10 is selected.

names(MyData) <- c("date","gender","height","weight","distance","time","pulse0","pulse1","pulse5","pulse10","sbp0","sbp1","sbp5","sbp10","dbp0","dbp1","dbp5","dbp10")

MyData$distance <-as.factor(MyData$distance)
str(MyData)

### Subset regression 
set.seed(123)
bestmodel <- regsubsets(pulse10 ~.,data = MyData,nvmax = 17, method = "exhaustive")
bs<-summary(bestmodel)
```


```{r echo = FALSE}

max(bs$rsq)
which.max(bs$rsq)
plot(bs$rsq,xlab="Number of Variables", ylab = "RSquare", type ="l")
points(8,bs$rsq[8], col ="red", cex = 2, pch =20)

min(bs$rss)
which.min(bs$rss)
plot(bs$rss,xlab="Number of Variables", ylab = "RSS", type ="l")
points(8,bs$rss[8], col ="red", cex = 2, pch =20)

min(bs$cp)
which.min(bs$cp)
plot(bs$cp,xlab="Number of Variables", ylab = "CP", type ="l")
points(8,bs$cp[8], col ="red", cex = 2, pch =20)

min(bs$bic)
which.min(bs$bic)
plot(bs$bic,xlab="Number of Variables", ylab = "bic", type ="l")
points(8,bs$bic[8], col ="red", cex = 2, pch =20)

### we are looking for a model with maximum RSquare, minimum RSS, cp and bic.
### The model with 8 predictors have minimum BIC and minimum cp however the model with 17 predictors have minimum RSS and maximum RSquare but it is clear from there plots that after 8 predictors there is not much significant increase in RSquare and no such signifcant decrease in RSS and hence model with 8 Predictors can be selected.


```


- we are looking for a model with maximum RSquare, minimum RSS,minimum  cp and minimum bic.

- The model with 8 predictors have minimum BIC and minimum cp however the model with 17 predictors have minimum RSS and maximum RSquare but it is   clear from there plots that after 8 predictors there is not much significant increase in RSquare and no such signifcant decrease in RSS and      hence model with 8 Predictors can be selected.

```{r, include = FALSE}
plot(bestmodel,scale="r2")
plot(bestmodel,scale="adjr2")
plot(bestmodel,scale="Cp")
plot(bestmodel,scale="bic")
coef(bestmodel,8)
### since both bic and cp is minimum at 8 predictors so coefficients are same for both.
```

### Using a Linear model with 8 best predictors selected from subset regression.

- Training and testing dataset are created.

- Model fitted on traing dataset.

```{r echo = FALSE}
s <- sample(nrow(MyData), round(.5*nrow(MyData)))
Atrain <- MyData[s,]
Atest <- MyData[-s,]

# Build the model
set.seed(123) 

modr <- lm(pulse10~gender+pulse0+pulse1+pulse5+sbp5+sbp10+dbp5+dbp10, data = Atrain)
summary(modr)
```


## Assessing model Assumptions
```{r echo = FALSE}
plot(modr)

```

- Residual vs Fitted : constant variance, Points are well scattered and mean of residuals seems to be a constant and hence linearity is not                             violated.

- Normal QQ: Majority of the points lie close to the line and hence normality assumption is not violated.

- Standardized Residual vs Fitted :82,441,525 have standardized residual more than 2 which is very large.

- Residuals vs Leverage value : Highly influential points are 82, 773,525.


# Making predictions and computing the R-square, RMSE and MAE for training dataset.
```{r echo = FALSE}

predictions <- modr %>% predict(Atrain,na.rm =TRUE)
data.frame( R2 = R2(predictions, Atrain$pulse10,na.rm =TRUE),
              RMSE = RMSE(predictions, Atrain$pulse10,na.rm =TRUE),
              MAE = MAE(predictions, Atrain$pulse10,na.rm =TRUE))

prediction_error <- RMSE(predictions,Atrain$pulse10,na.rm =TRUE)/mean(Atrain$pulse10,na.rm =TRUE)
prediction_error
```
- Prediction error rate for traing dataset is 5.36%.


# Making predictions and computing the R-square, RMSE and MAE for testing dataset.
```{r echo = FALSE}
predictions <- modr %>% predict(Atest,na.rm =TRUE)
data.frame( R2 = R2(predictions, Atest$pulse10,na.rm =TRUE),
              RMSE = RMSE(predictions, Atest$pulse10,na.rm =TRUE),
              MAE = MAE(predictions, Atest$pulse10,na.rm =TRUE))

prediction_error <- RMSE(predictions,Atest$pulse10,na.rm =TRUE)/mean(Atest$pulse10,na.rm =TRUE)
prediction_error

```
- Prediction error rate for test dataset is 5.39%.

###  Now using Ridge and lasso model for comparison.

- Na values are omitted.

- Linear model is fitted again after removing na values.

```{r, include = FALSE}

set.seed(123)
MyData_1 <- na.omit(MyData)

s <- sample(nrow(MyData_1), round(.5*nrow(MyData_1)))
train <- MyData_1[s,]
test <- MyData_1[-s,]

### Linear model

modr <- lm(pulse10~gender+pulse0+pulse1+pulse5+sbp5+sbp10+dbp5+dbp10, data = train)
summary(modr)
plot(modr)

### Residual vs Fitted : 1) constant variance. 2) outliers :744,839,27. 3) mean of residuals seems to be a constant and hence linearity is not violated.
### Normal QQ: Majority of the points lie close to the line and hence normality assumption is not violated.
### Standardized Residual vs Fitted :744,839,27 have standardized residual more than 2 which is very large.
### Residuals vs Leverage value : Highly influential points are 744,42,27.

# Make predictions and compute the R2, RMSE and MAE

train_predictions <- modr %>% predict(train,na.rm =TRUE)
data.frame(      R2 = R2(train_predictions, train$pulse10,na.rm =TRUE),
               RMSE = RMSE(train_predictions, train$pulse10,na.rm =TRUE),
                MAE = MAE(train_predictions, train$pulse10,na.rm =TRUE))

prediction_error <- RMSE(train_predictions,train$pulse10,na.rm =TRUE)/mean(train$pulse10,na.rm =TRUE)
prediction_error
### prediction error rate is 5.17%.


test_predictions <- modr %>% predict(test,na.rm =TRUE)
data.frame(     R2 = R2(test_predictions, test$pulse10,na.rm =TRUE),
              RMSE = RMSE(test_predictions, test$pulse10,na.rm =TRUE),
               MAE = MAE(test_predictions, test$pulse10,na.rm =TRUE))

prediction_error <- RMSE(test_predictions,test$pulse10,na.rm =TRUE)/mean(test$pulse10,na.rm =TRUE)
prediction_error
### prediction error rate is 5.62%.

### Ridge model

x.train <- data.matrix(train[,-10])
x.test  <- data.matrix(test[,-10])

y.train <- as.matrix(train$pulse10)
y.test  <- as.matrix(test$pulse10)

ridgemodel <- cv.glmnet(x.train,y.train, family = "gaussian",lambda =10^seq(4,-1,-.1), alpha =0)
bestlambda <- ridgemodel$lambda.1se
plot(ridgemodel)


train_ridge_predict <- predict(ridgemodel,s = bestlambda, newx = x.train)

test_ridge_predict <- predict(ridgemodel,s = bestlambda, newx = x.test)

train_Rmse <- sqrt(mean((y.train-train_ridge_predict)^2))
train_Rmse

test_Rmse <- sqrt(mean((y.test-test_ridge_predict)^2))
test_Rmse

# R_square for train
sst <- sum((y.train - mean(y.train))^2)
sse <- sum((train_ridge_predict - y.train)^2)

rsq <- 1 - sse / sst
rsq

# R_square for test
sst <- sum((y.test - mean(y.test))^2)
sse <- sum((test_ridge_predict - y.test)^2)

rsq <- 1 - sse / sst
rsq

### Lasso model


lassomodel <- cv.glmnet(x.train,y.train, family = "gaussian",lambda =10^seq(4,-1,-.1), alpha =1)

bestlambda <- lassomodel$lambda.1se ### for minimum mean cross validated error.
plot(lassomodel)

test_lasso_predict <- predict(lassomodel,s = bestlambda, newx = x.test)

train_lasso_predict <- predict(lassomodel,s = bestlambda, newx = x.train)


train_Rmse <- sqrt(mean((y.train-train_lasso_predict)^2))
train_Rmse

test_Rmse <- sqrt(mean((y.test-test_lasso_predict)^2))
test_Rmse

# R_square for train
sst <- sum((y.train - mean(y.train))^2)
sse <- sum((train_lasso_predict - y.train)^2)

rsq <- 1 - sse / sst
rsq

# R_square for test
sst <- sum((y.test - mean(y.test))^2)
sse <- sum((test_lasso_predict - y.test)^2)

rsq <- 1 - sse / sst
rsq


```

Comparison results:

Training data set

linear regression : R_square :  0.6913693		,RMSE: 5.715353	

Ridge  regression : R_square :  0.6670105   ,RMSE: 5.936612

Lasso regression  : R_square :  0.6617046   ,RMSE: 5.983723


Test dataset

linear regression : R_square :  0.6622686	  ,RMSE: 6.18969	

Ridge  regression : R_square :  0.6475221   ,RMSE: 6.319822

Lasso regression  : R_square :  0.6304456   ,RMSE: 6.471099

Since for both traing and testing dataset r_sqr of linear regression  is more than lasso and ridge model and RMSE value is less than lasso and ridge model so linear regression model is better than lasso and ridge regression models.

```{r, include = FALSE}
pred_res <- data.frame(MyData_1$pulse10, test_predictions, test_ridge_predict, test_lasso_predict) 
names(pred_res) <- c("Obs","Linear", "Ridge", "Lasso")

pred_res_by_model <- pred_res %>% 
  gather(value = prediction, key = model, -Obs) %>%
  mutate(abs_error = abs(Obs - prediction))

```

## comparison plot
```{r echo = FALSE}
ggplot(pred_res_by_model, aes(x = Obs)) +
  geom_point(aes(y = prediction)) +
  geom_abline(aes(slope = 1, intercept = 0)) + 
  facet_wrap(~model) +
  ylab("Predicted") +
  xlab("Observed") +
  labs(title = "Predicted v/s Observed") +
  theme(plot.title = element_text(hjust = 0.5))

```



```{r}

```

